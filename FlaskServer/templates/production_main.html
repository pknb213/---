{% extends 'main_base.html' %}
{% block head %}
<script>
    // As Jquery same the [ window.onload = function(){} ]
    $(document).ready(function () {
        pagination_test('production_main', 20);
        //main_table();
        state_change_btn_click_event();
        //state_change_table();
        model_filter();
        location_filter();
        state_filter();
        //main_table_info();
        //pagination_test();
        //detect_model_filter();
        //detect_location_filter();
        //detect_state_filter();
        itemChange();
        add_and_delete_row_btn('production_main');
        filtering();

        $('#insert_btn').click(function () {
            $('#insert_table > tbody:last').empty();
            insert_table();
        });
        $('#state_submit_btn').click(function () {
            if ($('#state').val().length == 0) {
                alert("빈 칸을 입력하세요");
                $('#state').focus();
                return false;
            }
        });
        $('#insert_submit_btn').click(function () {
            if ($('#insert_sn').val().length == 0) {
                alert("빈 칸을 입력하세요");
                $('#insert_sn').focus();
                return false;
            }
            if ($('#insert_header').val().length == 0) {
                alert("빈 칸을 입력하세요");
                $('#insert_header').focus();
                return false;
            }
        });
        $('#startDate').change(function () {
            console.log("Start Date Click");
            var a = $('#startDate').val();
            console.log(a);
            document.getElementById("sDate").value = $('#startDate').val();
            var b = $('#sDate').val();
            console.log(b);
        });
        $('#endDate').change(function () {
            console.log("End Date Click");
            var a = $('#endDate').val();
            console.log(a);
            document.getElementById("eDate").value = $('#endDate').val();
            var b = $('#eDate').val();
            console.log(b);
        });
        $('#filter').change(function () {
            console.log("Filter Value is Changed");
            itemChange();
        });

        function filtering() {
            $('#filter_btn').click(function () {
                var startDate = $('#startDate').val();
                var endDate = $('#endDate').val();
                var filter = $('#filter').val();
                var sub_filter = $('#sub_filter').val();
                console.log("sDate : " + startDate + " eDate : " + endDate + " filter : " + filter + " sFilter : " + sub_filter);
                $.ajax({
                    url: "/filtering2",
                    data: {
                        'sDate': startDate,
                        'eDate': endDate,
                        'filter': filter,
                        'sub_filter': sub_filter
                    },
                    type: "GET",
                    dataType: "json"
                })
                    .done(function (json) {
                        console.log("Filtering Ajax Done : \n" + json);
                        $('#pagination').twbsPagination('destroy');
                        pagination_test_ver('production_main', 20, json)
                    })
                    .fail(function (xhr, status, errorThrown) {
                        $("#filter_btn").html("오류발생<br>")
                            .append("오류명 : " + errorThrown + "<br>")
                            .append("상태 : " + status);
                    })
                    .always(function (xhr, status) {
                        //$("#barChart").html("요청 완료");
                    });
            });
        }

        function itemChange() {
            var selectItem = $("#filter").val();
            var table_rows = $('#main_rows').val();
            table_rows = JSON_parse_convertor(table_rows);
            if (table_rows == undefined) {
                console.log('Table length is empty');
            } else {
                if (selectItem == "전체") {
                    $('#sub_filter').empty();
                    var option = $("<option> </option>");
                    $('#sub_filter').append(option);
                } else if (selectItem == "모델") {
                    var model_list = new Array();
                    for (var i = 0; i < table_rows.length; i++) {
                        model_list[i] = table_rows[i]['model'];
                    }
                    var model_list_filtering = model_list.filter(function (item, idx, array) {
                        return array.indexOf(item) === idx;
                    });
                    console.log("Model : \n" + model_list_filtering);
                    $('#sub_filter').empty();
                    for (var count = 0; count < model_list_filtering.length; count++) {
                        //var option = $("<option>"+model_list[count]+"</option>");
                        var model_option = $("<option>").append(model_list_filtering[count]);
                        $('#sub_filter').append(model_option);
                    }
                } else if (selectItem == "위치") {
                    var location_list = new Array();
                    for (var i = 0; i < table_rows.length; i++) {
                        location_list[i] = table_rows[i]['location'];
                    }
                    var location_list_filtering = location_list.filter(function (item, idx, array) {
                        return array.indexOf(item) === idx;
                    });
                    console.log("Location : \n" + location_list_filtering);
                    $('#sub_filter').empty();
                    for (var count = 0; count < location_list_filtering.length; count++) {
                        var location_option = $("<option>").append(location_list_filtering[count]);
                        $('#sub_filter').append(location_option);
                    }
                } else if (selectItem == "상태") {
                    var state_list = new Array();
                    for (var i = 0; i < table_rows.length; i++) {
                        state_list[i] = table_rows[i]['state'];
                    }
                    var state_list_filtering = state_list.filter(function (item, idx, array) {
                        return array.indexOf(item) === idx;
                    });
                    console.log("State : \n" + state_list_filtering);
                    $('#sub_filter').empty();
                    for (var count = 0; count < state_list_filtering.length; count++) {
                        var state_option = $("<option>").append(state_list_filtering[count]);
                        $('#sub_filter').append(state_option);
                    }
                }
            }
            // for (var count = 0; count < changeItem.length; count++) {
            //     var option = $("<option>" + changeItem[count] + "</option>");
            //     $('#sub_filter').append(option);
            // }
        }

    });

</script>
{% endblock %}
{% block title %} 재고관리 페이지 {% endblock %}
{% block body_title %}Title{% endblock %}
{% block main_title %}재고 관리{% endblock %}
{% block body %}
<!--<form class="form-inline" action="/search" method="POST">
<form class="form-inline" action="/filtering2" method="POST">-->
<form class="form-inline" action="/filtering" method="POST">
    <div class="row container-fluid">
        <input type="date" id="startDate" name="startDate" value={{object.date()}} class="btn col-auto1 btn-primary">
        <input type="date" id="endDate" name="endDate" value={{object.date()}}
               class="btn col-auto1 btn-primary date_box">
        <input type="hidden" name="page" value="p_page"/>
        <!--<button type="submit" class="btn col-1 btn-warning">검색</button>-->
        <!--<button type="button" class="btn btn-primary col-1" onclick="location.href='/all_collection'">전체</button>-->
        <select id="filter" name="filter" class="btn btn-secondary col-1" value="">
            <option selected>전체</option>
            <option>모델</option>
            <option>위치</option>
            <option>상태</option>
        </select>
        <select id="sub_filter" name="sub_filter" class="btn btn-secondary col-1" value="">
            <!-- Dynamic creation -->
        </select>
        <button type="button" id="filter_btn" class="btn btn-secondary col-1">필터 적용</button>
        <!--<button type="button" id="state_change_btn" class="btn btn-warning col-1" data-toggle="modal"
                data-target="#shipment_modal">상태 변경-->
        <button type="button" id="state_change_btn" class="btn btn-warning col-1">상태 변경
        </button>
        <button type="button" id="insert_btn" class="btn btn-warning col-1" data-toggle="modal"
                data-target="#insert_modal"> 등록
        </button>
    </div>
    <!--</form>-->
    <hr/>
    <!--<form class="form-inline" action="/filtering2" method="POST">-->
    <input hidden id="sDate" name="sDate" value={{object.date()}}>
    <input hidden id="eDate" name="eDate" value={{object.date()}}>
    <!--
    <div>
        <button type="button" class="btn btn-primary col-1" onclick="location.href='/all_collection'">전체</button>
        <button type="button" class="btn btn-secondary col-1" onclick="location.href='/'">전체</button>
    </div>
    <div>
        <select id="model_filter" name="model_filter" class="btn btn-secondary col-1" value="">
            <option hidden>모델</option>
        </select>
    </div>
    <div>
        <select id="location_filter" name="location_filter" class="btn btn-secondary col-1" value="">
            <option hidden>위치</option>
        </select>
    </div>
    <div>
        <select id="state_filter" name="state_filter" class="btn btn-secondary col-1" value="">
            <option hidden>상태</option>
        </select>
    </div>
    -->
    <!--<a href="/insert_plan" class="btn btn-warning col-1 offset-6"
       onclick="winPop(this.href, {name:'insert_excel',width:1500,height:800}); return false;">생산계획입력 </a>-->
    <!--<button type="submit" class="btn btn-secondary col-1">필터 적용</button>-->
</form>
<hr/>
<!--<input hidden id="info_list" value="{# object.production_main_info_list() #}"/>-->
<!--<input hidden id="model_list" value="{# object.production_main_model() #}"/>-->
<!--<input hidden id="history_list" value="{# object.production_main_history() #}"/>-->
<input hidden id="main_rows" value="{{ object.main_table_rows() }}"/>
<input hidden id="specific_list" value="{{ specific_list }}"/>
<table class="table table-striped table-bordered table-sm text-center tablesorter" id="main_table">
    <thead class="thead-dark">
    <tr>
        <th></th>
        <th>모델명</th>
        <th>시리얼 넘버</th>
        <th>생산 주차</th>
        <th>위치</th>
        <th>상태</th>
        <th>추적</th>
    </tr>
    </thead>
    <tbody>
    <!--  Call of the Java Script main_stock_table Function (table) -->
    </tbody>
</table>
<!-- Pageination -->
<div class="text-center center-block">
    <div id="page_content"></div>
    <nav aria-label="Page navigation">
        <ul class="pagination" id="pagination" style="justify-content: center;"></ul>
    </nav>
</div>
<hr>
<div class="col-lg-12" id="ex3_Result1"></div>
<div class="col-lg-12" id="ex3_Result2"></div>
<!-- Test Part -->

<!-- The Product Insert Modal -->
<div class="modal fade" id="insert_modal">
    <div class="modal-dialog modal-lg">
        <form class="form-inline" action="/insert_data" method="POST" enctype=multipart/form-data>
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header text-white bg-secondary">
                    <h1 class="page-header">등 록</h1>
                </div>
                <!-- Modal Body -->
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered text-center" id="insert_table">
                            <thead class="thead-dark">
                            <tr>
                                <th>주 차</th>
                                <th>모델명</th>
                                <th>시리얼넘버</th>
                                <th>담당자</th>
                            </tr>
                            </thead>
                            <tbody>
                                <!-- insert_table().js -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="button" id='btn-add-row' class="btn offset-4 btn-secondary">행 추가하기</button>
                    <button type="button" id='btn-delete-row' class="btn btn-secondary">행 삭제하기</button>
                    <button type="submit" id="insert_submit_btn" class="btn btn-warning">확 인</button>
                    <button type="button" class="btn btn-warning" data-dismiss="modal">취 소</button>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- Modify State The Modal -->
<div class="modal fade" id="shipment_modal">
    <div class="modal-dialog modal-lg">
        <form class="form-inline" action="/state_change" method="POST" enctype=multipart/form-data>
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header text-white bg-secondary">
                    <h1 class="page-header">상태 변경 화면</h1>
                </div>
                <!-- Modal Body -->
                <div class="modal-body row">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered text-center" id="state_table">
                            <thead class="thead-dark">
                            <tr>
                                <th class="col-1">모델명</th>
                                <th class="col-3">시리얼 넘버</th>
                                <th class="col-5">위치</th>
                                <th>사유</th>
                                <th>비고</th>
                            </tr>
                            </thead>
                            <tbody>
                            <!--  Call of the Java Script Function (table) -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="submit" class="btn btn-warning">확 인</button>
                    <button type="button" class="btn btn-warning" data-dismiss="modal">취 소</button>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- The Detail Console Modal -->
<div class="modal fade" id="detail_modal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header text-white bg-secondary table-responsive">
                <table class="table table-borderless" id="detail_info">
                    <thead>
                    <tr>
                        <th><h1>상세 화면</h1></th>
                    </tr>
                    </thead>
                    <tbody>
                    <!--  Call of the Java Script Function (table) -->
                    </tbody>
                </table>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered text-center" id="detail_table">
                        <thead class="thead-dark">
                        <tr>
                            <th>날짜</th>
                            <th>위치</th>
                            <th>상태</th>
                            <th>비고(사유)</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!--  Call of the Java Script Function (table) -->
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-warning" data-dismiss="modal">확 인
                </button>
            </div>
        </div>

    </div>
</div>
{% endblock %}
